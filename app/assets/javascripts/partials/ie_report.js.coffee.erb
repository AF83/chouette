$(".imports.show, .exports.show, .compliance_checks.show").ready ->

  get_export_results = (html_container, html_element) ->
    html_container.children().each ->
      if($(this).is(html_element))
        $(this).show()
      else
        $(this).hide()

  getFileStatistics = (id)->
    Morris.Donut({
      element: id,
      data: [
        {
          label: $(".files_error").data('label'),
          value: $('.files_error span.file_name').size()
        },
        {
          label: $(".files_ignored").data('label'),
          value: $('.files_ignored span.file_name').size()
        },
        {
          label: $(".files_ok").data('label'),
          value: $('.files_ok span.file_name').size()
        }
      ],
      colors: [ "#e22b1b", "#898e7f", "#8fc861" ]
    }).on('click', update = (i, row) ->
      switch i
        when 0 then get_export_results($(".report"), $(".files_error"))
        when 1 then get_export_results($(".report"), $(".files_ignored"))
        when 2 then get_export_results($(".report"), $(".files_ok"))
    )
    get_export_results($(".report"), $(".files_error"))

  if $( "#files_statistics" ).length
    getFileStatistics('files_statistics')

  $('#ie_tab a.ie_tab_file').click (e) ->
    e.preventDefault()
    $('#ie_tab_line').hide()
    $(this).tab('show')
    $('#files_statistics, .caption').show()
    get_export_results($(".report"), $(".files_error"))

  $('#ie_tab a.ie_tab_line').click (e) ->
    e.preventDefault()
    $(this).tab('show')
    $('#files_statistics, .caption').hide()
    get_export_results( $(".report"), $("div.lines"))

  refreshInterval = $(".report").data("refresh-interval")
  if refreshInterval > 0
    reloadPage = () -> window.location.reload()
    setInterval(reloadPage,refreshInterval * 1000)
